#!/usr/bin/env Rscript

library(optparse)

option_list <- c(make_option('--input', type='character', default='dipp-rf-uniq.RData'),
                 make_option('--output', type='character', default='Rplots.pdf')
                )

parser <- OptionParser(option_list = option_list)
options <- parse_args(parser)

library(phyloseq)
library(ggplot2)
library(plyr)

source('lib/ggplot_theme.R')

load(options$input)

ss <- subset_taxa(dipp, Species == 'dorei-vulgatus')

glom <- tax_glom(ss, taxrank='Species')


meta <- data.frame(sample_data(glom))
otus <- data.frame(otu_table(glom))

meta$dorei <- otus[,1]

ggplot(meta,
       aes(x=age_at_sampling,
           y=dorei,
           color=seroconverted)) +
geom_point() +
geom_smooth() +
facet_wrap(seroconverted~dipp_person) +
coord_cartesian(ylim=c(0, 1), xlim=c(100,600)) +
opts(strip.background = theme_blank(),
     strip.text.x = theme_blank()) +
ggplot.theme
